#!/bin/bash


Red='\033[0;31m'      # Red
Green='\033[0;32m'    # Green
Yellow='\033[0;33m'   # Yellow
Blue='\033[0;34m'     # Blue
Purple='\033[0;35m'   # Purple
Cyan='\033[0;36m'     # Cyan
NC='\033[0m' # No Color
BCyan='\033[1;36m'    # Cyan
BWhite='\033[1;37m'   # White

(( EUID )) && { printf "${Red}Run this script with root priviliges."; exit 1; } || printf "${Purple}Running as root, starting service..."

printf "${BCyan}
    _         _        ____            _            _
   / \  _   _| |_ ___ |  _ \ ___ _ __ | |_ ___  ___| |_
  / _ \| | | | __/ _ \| |_) / _ \ '_ \| __/ _ \/ __| __|
 / ___ \ |_| | || (_) |  __/  __/ | | | ||  __/\__ \ |_
/_/   \_\__,_|\__\___/|_|   \___|_| |_|\__\___||___/\__|
${NC}"

echo "Purpose: Automates some penetration testing tasks"

#HELP_MENU
function Help()
{
    echo "    -h    help option"
    echo "    -n    network scan; provide IP address"
    echo "    -d    directory search; provide URL"
    echo "    -w    web vulnerability scan for; provide URL"
}

#./requirements.sh

#NMAP_FUNC
function nmapscan()
{
    mkdir AP_nmap_results
echo -e "A directory titled AP_nmap_results has been created to store the results of nmap scans performed on your target.
In order to access the scan results you must move to the AP_nmap_results directory using the following command.
cd AP_nmap_results \n"
    printf "${Yellow}Starting 65k Port scan on Target: ${OPTARG}.${NC} \n"
    nmap ${OPTARG} -p- -O -Pn  >> ./AP_nmap_results/results_of_${OPTARG}
    printf "${Green}65k port scan Results saved in results_of_${OPTARG}.${NC} \n"

    printf "${Yellow}Starting CSRF and password scan on ${OPTARG}. Please wait... \n"
    nmap ${OPTARG} -sV --script http-csrf,http-passwd   >> ./AP_nmap_results/CSRF_passwd_of_${OPTARG}
    printf "${Green}CSRF, passwd scan results stored in CSRF_passwd_of_${OPTARG}. \n"

    printf "${Yellow}Starting DNS scan on ${OPTARG} \n"
    nmap ${OPTARG} --script=dns-service-discovery,dns-recursion -p 5353  >> ./AP_nmap_results/DNS_of_${OPTARG}
    printf "${Green}DNS results stored in DNS_of_${OPTARG} \n"

    printf "${Yellow}Starting FTP B-F on ${OPTARG}. Please wait... \n"
    nmap ${OPTARG} --script ftp-brute -p 21  >> ./AP_nmap_results/FTP_of_${OPTARG}
    printf "${Green}FTP bruteforce default-logon results stored in DNS_of_${OPTARG}. \n"

    printf "${BWhite} All network map scans complete. \n ${NC}"
}

#web_enum FUNC
function directory_discovery()
{

    mkdir AP_webdirectory_results

echo -e "A directory titled AP_webdirectory_results has been created to store the results of web_enumerator scans performed on your target.
In order to access the webdirectory-results you must move to the AP_webdirectory_results directory using the following command.
cd AP_webdirectory_results \n"
    printf "${Yellow}Starting WebDir Enumeration on Target: ${OPTARG}. Please wait ... \n"
 python3 ./web_enumerator/web_discover.py --url ${OPTARG} --wordlist /usr/share/wordlists/dirb/common.txt > ./AP_webdirectory_results/results
    mv ./AP_webdirectory_results/results ./AP_webdirectory_results/WebEnum_results_of_${OPTARG}
    printf "${Green}Web directory results stored in WebDir_results_of_${OPTARG} \n"
    printf "${BWhite} WebDir Attack Complete! \n ${NC}"
}

function webscan ()
{
    mkdir AP_webvulnerability_results
echo -e "A directory titled AP_webvulnerability_results has been created to store the results of joomla and wordpress scans performed on your target.
In order to access the webvulnerability_results you must move to the AP_webvulnerability_results directory using the the following command:
cd AP_webvulnerability_results \n"
    printf "${Yellow}Starting Web scan on Target: ${OPTARG}. Please wait ... \n"
    joomscan -u ${OPTARG} > ./AP_webvulnerability_results/WebScan_results_of_${OPTARG}
    wpscan --url ${OPTARG} --enumerate p >> ./AP_webvulnerability_results/WebScan_results_of_${OPTARG}
    printf "${Green}Web scan results stored in WebScan_results_of_${OPTARG} \n"
    printf "${Yellow}Starting domain scan \n"
    host -v ${OPTARG} > ./AP_webvulnerability_results/WebScan_domain_results_of_${OPTARG}
    printf "${Green}Web domain results stored in WebScan_domain_results_of_${OPTARG} \n"
    printf "${BWhite} Web & Domain Scans Complete! \n ${NC}"
}


while getopts "n:d:w:h" option; do
    case $option in
    n) #runs nmap for given ip
    nmapscan ${OPTARG} ;;
    d) #directory discovery
    directory_discovery ${OPTARG} ;;
    w) #joomla-scan and wpscan
    webscan ${OPTAGRS} ;;
            h) #shows the help menu
                    Help 0;;
    \?) printf "${Purple}example usage: ${NC} \n ${BWhite} ./AutoPentest.sh -n 192.168.1.1 -d https://127.0.0.1 -w https://127.0.0.1 \n ${NC}"
    esac
done
